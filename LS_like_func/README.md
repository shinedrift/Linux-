记录遇到的问题
1. 遍历目录后，得到dirent结构体后，还需要构建文件和目录的路径才能传入到打印函数
    	while((direntp=readdir(dirp))!=NULL) 
	{
		/* 给文件或目录名添加路径:argv[1]+"/"+direntp->d_name */
		char dirbuf[512]; 
		memset(dirbuf,0,sizeof(dirbuf)); 
		strcpy(dirbuf,argv[1]); 
		strcat(dirbuf,"/"); 
		strcat(dirbuf,direntp->d_name); 
		if(get_file_size_time(dirbuf)==-1) break;
	}
2. 打印的文件或路径名单独传入到打印函数，才能有ls -l一样的文件名打印结果

3. 开始函数写错了，输入目录正确，但是打开失败。后来修改后报错无法获取stat
。引入到问题1，最初使用snprintf构建，但是不熟练，看到段错误之后换了方法

**实验报告：实现简化版 `ls -l` 的功能**

### 一、实验目的
本实验旨在使用 C 语言编写一个工具程序，实现类似于 Linux 系统命令 `ls -l` 的部分功能。该工具程序能够列出指定目录下的文件及其元数据信息，包括文件类型、权限、大小和名称。通过本实验，学习如何使用 `opendir`、`readdir`、`stat` 等系统调用来操作文件系统，熟悉 Linux 文件系统元数据的获取方式。

### 二、实验环境
- **操作系统**: Ubuntu 20.04
- **开发工具**: GCC 9.4.0
- **编程语言**: C 语言

### 三、实验步骤
1. **头文件与函数封装**
   将获取文件信息的功能分割为多个函数模块，提高代码的可读性和可维护性：
   - `get_file_type()` 用于获取文件的类型（如普通文件、目录、符号链接等）。
   - `get_permissions()` 用于获取文件的权限信息，返回类似于 `rwx` 格式的权限位。
   - `get_file_size()` 用于获取文件的大小。
   - `get_file_name()` 只返回文件名，而非完整路径。

2. **实现 `stat` 获取文件信息**
   使用 `stat()` 函数来获取文件的元数据。`stat` 能够获取目标文件的详细信息，例如文件类型、权限、大小等。通过这些信息，程序可以模拟 `ls -l` 的部分功能。

3. **目录遍历**
   使用 `opendir()` 打开指定目录，使用 `readdir()` 遍历目录中的每一个文件或子目录。通过调用 `stat()` 函数来获取每个文件的详细信息，并进行格式化输出。

4. **路径处理**
   在读取目录内容时，需构造完整的文件路径来调用 `stat()` 函数。使用 `snprintf()` 函数将目录路径与文件名组合，以正确处理相对路径和绝对路径的问题。

5. **文件名提取**
   修改 `get_file_name()` 函数以只返回文件名，使用 `strrchr()` 查找路径中的最后一个斜杠 `/`，从而返回文件或目录的名称。

### 四、实验结果
本程序能够成功实现如下功能：
- 列出指定目录中的所有文件及子目录。
- 输出每个文件的详细信息，包括：
  - **文件类型**：如普通文件、目录等。
  - **权限位**：9 个权限位信息，例如 `-rw-r--r--`。
  - **文件大小**：以字节为单位显示文件大小。
  - **文件名称**：只显示文件或目录名，而不包含完整路径。

测试结果表明，对于普通文件和目录，本程序能够正确显示其信息，并模拟 `ls -l` 的输出格式。

### 五、遇到的问题及解决方法
1. **路径拼接错误**
   在构造完整路径时，初期版本由于未正确拼接目录路径和文件名，导致 `stat()` 无法找到文件。通过使用 `snprintf()` 来拼接路径，确保了路径的正确性。

2. **无法读取符号链接的元数据**
   本次实验中只使用了 `stat()`，而未使用 `lstat()`。因此，当遇到符号链接时，本程序会解析符号链接指向的目标文件，而不是链接本身的元数据。若需要处理符号链接，后续可使用 `lstat()` 来获取符号链接本身的信息。

3. **权限问题**
   在读取系统中受限目录（如 `/root`）时，遇到权限不足的问题。通过使用 `sudo` 提升权限可以解决，但这要求用户具备超级用户权限。

### 六、总结与体会
本次实验实现了类似于 `ls -l` 的基本功能，通过使用 `opendir()`、`readdir()` 和 `stat()`，掌握了如何在 Linux 环境下读取目录并获取文件元数据。同时，模块化设计增强了代码的清晰性和可维护性。

尽管本程序能够正确显示普通文件和目录的信息，但在处理符号链接时还有待改进，后续可以通过引入 `lstat()` 函数来实现对符号链接的支持。此外，在权限管理、路径处理等方面也获得了宝贵的经验，增强了对 Linux 文件系统的理解。

通过本实验，不仅深入学习了 Linux 环境下的系统调用，还提高了编写系统程序的能力。未来可以进一步扩展功能，例如添加对不同文件类型的处理、输出格式的增强等，使程序更加接近完整的 `ls` 工具。


